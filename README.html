<html><head><title>CR galileo</title><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol{margin:0;padding:0}.c0{border-bottom-width:1pt;border-top-style:solid;width:468pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c2{line-height:1.0;padding-top:0pt;text-align:left;direction:ltr;padding-bottom:0pt}.c8{vertical-align:baseline;font-style:normal;text-decoration:none;font-weight:normal}.c10{vertical-align:baseline;font-style:normal;text-decoration:none;font-weight:bold}.c11{line-height:1.15;padding-top:0pt;text-align:left;padding-bottom:0pt}.c12{color:#000000;font-size:9pt;font-family:"Courier New"}.c6{color:#ff0000;font-size:9pt;font-family:"Courier New"}.c17{margin-right:auto;border-collapse:collapse}.c20{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c7{color:#1155cc;text-decoration:underline}.c3{color:inherit;text-decoration:inherit}.c4{direction:ltr;margin-left:18pt}.c13{font-size:9pt;font-family:"Courier New"}.c19{text-align:right}.c16{font-size:14pt}.c18{height:0pt}.c14{margin-left:36pt}.c15{text-align:center}.c9{height:11pt}.c5{direction:ltr}.c1{font-style:italic}.title{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:36pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:18pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}h2{padding-top:18pt;line-height:1.15;text-align:left;color:#000000;font-size:14pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h3{padding-top:14pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h4{padding-top:12pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Arial";padding-bottom:2pt}h5{padding-top:11pt;line-height:1.15;text-align:left;color:#666666;font-size:10pt;font-family:"Arial";font-weight:bold;padding-bottom:2pt}h6{padding-top:10pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:10pt;font-family:"Arial";padding-bottom:2pt}</style></head><body class="c20"><p class="c5"><span class="c16">GERVAIL Antoine</span></p><p class="c5"><span class="c16">ZIAN-CHERIF Amine</span></p><p class="c5 c19"><span class="c16">M2P GI</span></p><p class="c15 c5 title"><a name="h.e7qdxyrylmeb"></a><span>Galileo</span></p><p class="c4"><span class="c7"><a class="c3" href="#h.pql5slic2k3o">Introduction</a></span></p><p class="c4"><span class="c7"><a class="c3" href="#h.pd2gdfp4b6k6">Architecture</a></span></p><p class="c5 c14"><span class="c7"><a class="c3" href="#h.fw83gaxgadd9">Galileo</a></span></p><p class="c14 c5"><span class="c7"><a class="c3" href="#h.1osdm9s5zv2k">PC</a></span></p><p class="c4"><span class="c7"><a class="c3" href="#h.i0rfymv6vvl4">Logiciel</a></span></p><p class="c14 c5"><span class="c7"><a class="c3" href="#h.155ox57qjy2b">Galileo</a></span></p><p class="c14 c5"><span class="c7"><a class="c3" href="#h.j8ot1tihnb6">PC</a></span></p><p class="c9 c5"><span></span></p><p class="c9 c5"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c9 c5"><span></span></p><h1 class="c5"><a name="h.pql5slic2k3o"></a><span>Introduction</span></h1><p class="c5"><span>Le capteur que l&rsquo;on nous a confi&eacute; est un lecteur de Tag NFC. Le but de ce projet &eacute;tait de r&eacute;cup&eacute;rer les donn&eacute;es de ce lecteur et de s&rsquo;en servir pour effectuer un vote. L&rsquo;id&eacute;e &eacute;tait de relier trois lecteurs NFC sur un galileo et d&rsquo;affecter &agrave; chacun une valeur pour le vote actuel (Positif, N&eacute;gatif, Neutre). Ce syst&egrave;me de vote permet une grande facilit&eacute; d&rsquo;utilisation puisqu&rsquo;on peut imaginer l&rsquo;utiliser dans une conf&eacute;rence ou chaque invit&eacute; a un badge avec un Tag NFC dont il se servira pour voter simplement en l&rsquo;approchant du lecteur correspondant &agrave; son choix. Ce syst&egrave;me rend le vote tr&egrave;s rapide et permet du surcro&icirc;t de v&eacute;rifier que chaque personne ne vote qu&rsquo;une fois.</span></p><p class="c5"><span>Les diff&eacute;rents outils utilis&eacute;s sont Mqtt et MongoDB. Nous les utilisons au travers de scripts NodeJS et Python.</span></p><p class="c9 c5"><span></span></p><h1 class="c5"><a name="h.pd2gdfp4b6k6"></a><span>Architecture</span></h1><p class="c5"><span>Voici l&rsquo;architecture du projet :</span></p><p class="c9 c5"><span></span></p><p class="c5 c15"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 470.50px; height: 348.27px;"><img alt="" src="images/image00.png" style="width: 470.50px; height: 348.27px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c9 c5"><span></span></p><p class="c5"><span>Les trois lecteurs NFC sons connect&eacute;s en USB sur le port </span><span class="c1">USB Host </span><span>du Galileo. Le Galileo est reli&eacute; directement au PC par un cable RJ 45.</span></p><p class="c9 c5"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c9 c5"><span></span></p><h2 class="c5"><a name="h.fw83gaxgadd9"></a><span>Galileo</span></h2><p class="c5"><span>Le Galileo fait tourner un syst&egrave;me Linux pr&eacute;sent sur sa carte SD. Le fait d&rsquo;avoir Linux sur le Galileo nous permet d&rsquo;avoir le support de l&rsquo;USB ainsi qu&rsquo;un interpr&egrave;te python et l&rsquo;ajout des librairies n&eacute;cessaires pour mqtt est &eacute;galement facilit&eacute;. Nous avons compil&eacute; mosquitto (Mqtt) directement sur la carte pour pouvoir lancer un broker Mqtt et se servir des bindings python pour le Mqtt.</span></p><h2 class="c5"><a name="h.1osdm9s5zv2k"></a><span>PC</span></h2><p class="c5"><span>Le PC a lui aussi un broker Mqtt qui tourne et qui lui permet de recevoir les messages envoy&eacute; par le Galileo. On lance &eacute;galement une base de donn&eacute;es MongoDB qui nous sert &agrave; stocker les votes. Pour finir nous utilisons un serveur NodeJS pour recevoir les messages du Galileo et remplir la base de donn&eacute;es.</span></p><p class="c9 c5"><span></span></p><h1 class="c5"><a name="h.i0rfymv6vvl4"></a><span>Logiciel</span></h1><h2 class="c5"><a name="h.155ox57qjy2b"></a><span>Galileo</span></h2><p class="c5"><span>On lance trois scripts python, un pour chaque lecteur NFC branch&eacute; en USB. Chacun g&egrave;re une valeur pour le vote (Positif=0, N&eacute;gatif=1, Neutre=2). Pour lancer ces scripts il faut r&eacute;cup&eacute;rer l&rsquo;identifiant du device USB &agrave; l&rsquo;aide de la commande lsusb :</span></p><p class="c5 c9"><span></span></p><a href="#" name="ecfa5ede0d0f01a851eea03ae6dcc29fdd6bcb6d"></a><a href="#" name="0"></a><table cellpadding="0" cellspacing="0" class="c17"><tbody><tr class="c18"><td class="c0"><p class="c2"><span class="c8 c12">root@clanton:~# lsusb</span></p><p class="c2"><span class="c13">Bus </span><span class="c13">002</span><span class="c13">&nbsp;Device </span><span class="c13">003</span><span class="c8 c12">: ID 05e3:0608 Genesys Logic, Inc. USB-2.0 4-Port HUB</span></p><p class="c2"><span class="c8 c12">Bus 001 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub</span></p><p class="c2"><span class="c8 c12">Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span></p><p class="c2"><span class="c13">Bus </span><span class="c6">002</span><span class="c13">&nbsp;Device </span><span class="c6">005</span><span class="c13">: ID 04e6:5591</span><span class="c6 c8">&nbsp;SCM Microsystems, Inc.</span></p><p class="c2"><span class="c8 c12">Bus 002 Device 004: ID 04e6:5591 SCM Microsystems, Inc.</span></p></td></tr></tbody></table><p class="c9 c5"><span></span></p><p class="c5"><span>Par exemple si l&rsquo;on s&rsquo;int&eacute;resse au premier lecteur SCM Microsystems, les identifiants qui nous int&eacute;ressent sont 002 et 005.</span></p><p class="c5"><span>Admettons qu&rsquo;on affecte &agrave; ce lecteur la valeur 0, voici l&rsquo;appel &agrave; effectuer :</span></p><p class="c9 c5"><span></span></p><a href="#" name="6e5d20302cfb2e6bcd6cf63a9574416d0c10282b"></a><a href="#" name="1"></a><table cellpadding="0" cellspacing="0" class="c17"><tbody><tr class="c18"><td class="c0"><p class="c2"><span class="c13">python read.py 002:005 1</span></p></td></tr></tbody></table><p class="c9 c5"><span></span></p><p class="c5"><span>On fera de m&ecirc;me pour les autres lecteurs.</span></p><p class="c5"><span>Le script read.py se sert de la librairie python nfc. On d&eacute;finit un handler pour chaque lecture d&rsquo;un tag NFC. Ce handler lit le contenu du tag NFC et transmet dans un message Mqtt l&rsquo;id du votant et la valeur du vote.</span></p><hr style="page-break-before:always;display:none;"><p class="c9 c5"><span></span></p><h2 class="c5"><a name="h.j8ot1tihnb6"></a><span>PC</span></h2><p class="c5"><span>Du c&ocirc;t&eacute; du PC on a dans un premier temps un serveur NodeJS qui permet d&rsquo;interfacer avec le Galileo, la base de donn&eacute;es MongoDB et le programme python d&rsquo;affichage des votes.</span></p><p class="c5"><span>La base de donn&eacute;es MongoDB permet le stockage des votes. Elle nous permet &eacute;galement indirectement de v&eacute;rifier qu&rsquo;une personne ne v&ocirc;te pas deux fois gr&acirc;ce &agrave; l&rsquo;exception duplicate key qui est lev&eacute; si la personne a d&eacute;j&agrave; v&ocirc;t&eacute;.</span></p><p class="c9 c5"><span></span></p><p class="c5"><span>Pour le serveur NodeJS on a besoin de deux parties principales.</span></p><p class="c5"><span>La premi&egrave;re partie est la base de donn&eacute;es mongoDB. On se connecte &agrave; celle-ci pour pouvoir ajouter des entr&eacute;es. Pour ajouter des entr&eacute;es il faut cr&eacute;er un sch&eacute;ma, il est compos&eacute; d&#39;un id unique et de la valeur du vote.</span></p><p class="c5"><span>La seconde partie est le support des messages mqtt. A chaque vote, on re&ccedil;oit un message mqtt qui nous en informe. Pour cela on souscrit au topic des votes, avec un client qui &eacute;coute sur l&#39;ip du galileo.</span></p><p class="c5"><span>A chaque r&eacute;ception d&#39;un message on tente d&#39;ins&eacute;rer le vote avec l&#39;id du votant. Si cet id est d&eacute;j&agrave; pr&eacute;sent dans la table on ne duplique pas son vote et on affiche un message d&#39;erreur. Si le vote est valide on transmet un second message mqtt sur un autre topic qui servira &agrave; l&#39;affichage.</span></p><p class="c9 c5"><span class="c1"></span></p><p class="c5"><span>Le programme d&rsquo;affichage lorsqu&rsquo;il est lanc&eacute; r&eacute;cup&egrave;re les valeurs d&eacute;j&agrave; pr&eacute;sente en base de don&eacute;es. Par la suite &agrave; chaque r&eacute;ception d&rsquo;un message mqtt constitu&eacute; de la valeur du vote l&rsquo;affichage est actualis&eacute;. L&rsquo;affichage est r&eacute;alis&eacute; &agrave; l&rsquo;aide de la librairie pygame qui permet d&rsquo;afficher des rectangles et du texte. Les coordonn&eacute;es des rectangles sont calcul&eacute;s selon la taille du plus grand des trois, de mani&egrave;re &agrave; ce que l&rsquo;&eacute;chelle soit respect&eacute;e.</span></p><p class="c5 c11"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 350.67px;"><img alt="affichage.png" src="images/image01.png" style="width: 624.00px; height: 350.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></body></html>