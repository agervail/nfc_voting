<html><head><title>Copie de CR galileo</title><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">.lst-kix_hg9egen3l8tk-6>li:before{content:"\0025cf  "}.lst-kix_hg9egen3l8tk-8>li:before{content:"\0025a0  "}ul.lst-kix_hg9egen3l8tk-8{list-style-type:none}.lst-kix_hg9egen3l8tk-3>li:before{content:"\0025cf  "}ul.lst-kix_hg9egen3l8tk-6{list-style-type:none}.lst-kix_hg9egen3l8tk-2>li:before{content:"\0025a0  "}ul.lst-kix_hg9egen3l8tk-7{list-style-type:none}ul.lst-kix_hg9egen3l8tk-4{list-style-type:none}ul.lst-kix_hg9egen3l8tk-5{list-style-type:none}.lst-kix_o0jvza34prkq-3>li:before{content:"\0025cf  "}.lst-kix_o0jvza34prkq-5>li:before{content:"\0025a0  "}ul.lst-kix_hg9egen3l8tk-2{list-style-type:none}.lst-kix_hg9egen3l8tk-4>li:before{content:"\0025cb  "}ul.lst-kix_hg9egen3l8tk-3{list-style-type:none}ul.lst-kix_hg9egen3l8tk-0{list-style-type:none}ul.lst-kix_hg9egen3l8tk-1{list-style-type:none}ul.lst-kix_o0jvza34prkq-7{list-style-type:none}.lst-kix_o0jvza34prkq-0>li:before{content:"\0025cf  "}ul.lst-kix_o0jvza34prkq-6{list-style-type:none}.lst-kix_o0jvza34prkq-4>li:before{content:"\0025cb  "}ul.lst-kix_o0jvza34prkq-5{list-style-type:none}ul.lst-kix_o0jvza34prkq-4{list-style-type:none}ul.lst-kix_o0jvza34prkq-3{list-style-type:none}ul.lst-kix_o0jvza34prkq-2{list-style-type:none}.lst-kix_o0jvza34prkq-8>li:before{content:"\0025a0  "}.lst-kix_hg9egen3l8tk-1>li:before{content:"\0025cb  "}.lst-kix_hg9egen3l8tk-0>li:before{content:"\0025cf  "}ul.lst-kix_o0jvza34prkq-1{list-style-type:none}ul.lst-kix_o0jvza34prkq-8{list-style-type:none}ul.lst-kix_o0jvza34prkq-0{list-style-type:none}.lst-kix_hg9egen3l8tk-5>li:before{content:"\0025a0  "}.lst-kix_hg9egen3l8tk-7>li:before{content:"\0025cb  "}.lst-kix_o0jvza34prkq-6>li:before{content:"\0025cf  "}.lst-kix_o0jvza34prkq-1>li:before{content:"\0025cb  "}.lst-kix_o0jvza34prkq-7>li:before{content:"\0025cb  "}.lst-kix_o0jvza34prkq-2>li:before{content:"\0025a0  "}ol{margin:0;padding:0}.c14{border-bottom-width:1pt;border-top-style:solid;width:468pt;border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-bottom-style:solid;vertical-align:top;border-top-color:#000000;border-left-color:#000000;border-right-color:#000000;border-left-style:solid;border-right-width:1pt;border-left-width:1pt}.c19{line-height:1.15;padding-top:0pt;text-align:left;padding-bottom:0pt}.c9{vertical-align:baseline;font-style:normal;text-decoration:none;font-weight:normal}.c3{line-height:1.0;padding-top:0pt;text-align:left;padding-bottom:0pt}.c17{vertical-align:baseline;font-style:normal;text-decoration:none;font-weight:bold}.c13{color:#000000;font-size:11pt;font-family:"Courier New"}.c11{margin-right:auto;border-collapse:collapse}.c15{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c8{padding-left:0pt;line-height:1.0;margin-left:36pt}.c7{font-size:11pt;font-weight:normal}.c0{height:11pt;direction:ltr}.c10{margin:0;padding:0}.c1{font-size:9pt;font-family:"Courier New"}.c12{line-height:1.0}.c16{color:#000000}.c20{height:18pt}.c6{font-style:italic}.c2{direction:ltr}.c5{height:0pt}.c21{font-family:"Courier New"}.c18{text-align:center}.c4{color:#ff0000}.title{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:36pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:18pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}h2{padding-top:18pt;line-height:1.15;text-align:left;color:#000000;font-size:14pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h3{padding-top:14pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h4{padding-top:12pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Arial";padding-bottom:2pt}h5{padding-top:11pt;line-height:1.15;text-align:left;color:#666666;font-size:10pt;font-family:"Arial";font-weight:bold;padding-bottom:2pt}h6{padding-top:10pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:10pt;font-family:"Arial";padding-bottom:2pt}</style></head><body class="c15"><h1 class="c12 c2"><a name="h.ta65w3orh8wp"></a><span>Dependencies</span></h1><h1 class="c12 c2"><a name="h.ibjusa45qruy"></a><span class="c7">For the galileo you need to use a linux distibution.</span></h1><ul class="c10 lst-kix_o0jvza34prkq-0 start"><li class="c8 c2"><h1 style="display:inline"><a name="h.ibjusa45qruy"></a><span class="c7">Python</span></h1></li><li class="c8 c2"><h1 style="display:inline"><a name="h.ibjusa45qruy"></a><span class="c7">Python-nfcpy</span></h1></li><li class="c8 c2"><h1 style="display:inline"><a name="h.ibjusa45qruy"></a><span class="c7">Mosquitto</span></h1></li></ul><h1 class="c12 c2"><a name="h.ibjusa45qruy"></a><span class="c7">On the server side you will need.</span></h1><ul class="c10 lst-kix_hg9egen3l8tk-0 start"><li class="c8 c2"><h1 style="display:inline"><a name="h.ibjusa45qruy"></a><span class="c7">Python</span></h1></li><li class="c8 c2"><h1 style="display:inline"><a name="h.ibjusa45qruy"></a><span class="c7">Python-nfcpy</span></h1></li><li class="c8 c2"><h1 style="display:inline"><a name="h.ibjusa45qruy"></a><span class="c7">Python-pygame</span></h1></li><li class="c8 c2"><h1 style="display:inline"><a name="h.ibjusa45qruy"></a><span class="c7">Mosquitto</span></h1></li><li class="c8 c2"><h1 style="display:inline"><a name="h.ibjusa45qruy"></a><span class="c7">NodeJS</span></h1></li><li class="c2 c8"><h1 style="display:inline"><a name="h.ibjusa45qruy"></a><span class="c7">MongoDB</span></h1></li></ul><h1 class="c12 c2"><a name="h.fqyjjxdh29y"></a><span>Usage</span></h1><h1 class="c12 c2"><a name="h.4tkpxhzfnts3"></a><span class="c7">First you must launch the three readers on the galileo, one for each nfc reader with a different vote value.</span></h1><p class="c0"><span></span></p><a href="#" name="e1f80835352e891cf771e690d394076484df362a"></a><a href="#" name="0"></a><table cellpadding="0" cellspacing="0" class="c11"><tbody><tr class="c5"><td class="c14"><p class="c3 c2"><span class="c9 c13">python read.py 002:004 0</span></p></td></tr></tbody></table><h1 class="c12 c2"><a name="h.5ouetsojh3gs"></a><span class="c7">On the server side you have to run the mongoDB database and the mqtt broker.</span></h1><a href="#" name="e596c9a7ba1d8d239ed9a40a58ba39658b89c429"></a><a href="#" name="1"></a><table cellpadding="0" cellspacing="0" class="c11"><tbody><tr class="c5"><td class="c14"><p class="c3 c2"><a name="h.6tstvmuyc7ab"></a><span class="c21">sudo ./bin/mongod --rest<br>mosquitto</span></p></td></tr></tbody></table><h1 class="c2 c12"><a name="h.eluci26i8yi7"></a><span class="c7"><br>Then you run the NodeJS server and the display python programm.</span></h1><p class="c0"><span></span></p><a href="#" name="dc8efe3d234f678de3ea0af7d2af2efd6d41869b"></a><a href="#" name="2"></a><table cellpadding="0" cellspacing="0" class="c11"><tbody><tr class="c5"><td class="c14"><p class="c3 c2"><span class="c9 c13">node serv.js<br>python affichage.py</span></p></td></tr></tbody></table><p class="c0"><span></span></p><h1 class="c12 c2 c20"><a name="h.n75uunb8d8jc"></a><span class="c7"><br></span></h1><h1 class="c2"><a name="h.pql5slic2k3o"></a><span>Introduction</span></h1><p class="c2"><span>Le capteur que l&rsquo;on nous a confi&eacute; est un lecteur de Tag NFC. Le but de ce projet &eacute;tait de r&eacute;cup&eacute;rer les donn&eacute;es de ce lecteur et de s&rsquo;en servir pour effectuer un vote. L&rsquo;id&eacute;e &eacute;tait de relier trois lecteurs NFC sur un galileo et d&rsquo;affecter &agrave; chacun une valeur pour le vote actuel (Positif, N&eacute;gatif, Neutre). Ce syst&egrave;me de vote permet une grande facilit&eacute; d&rsquo;utilisation puisqu&rsquo;on peut imaginer l&rsquo;utiliser dans une conf&eacute;rence ou chaque invit&eacute; a un badge avec un Tag NFC dont il se servira pour voter simplement en l&rsquo;approchant du lecteur correspondant &agrave; son choix. Ce syst&egrave;me rend le vote tr&egrave;s rapide et permet du surcro&icirc;t de v&eacute;rifier que chaque personne ne vote qu&rsquo;une fois.</span></p><p class="c2"><span>Les diff&eacute;rents outils utilis&eacute;s sont Mqtt et MongoDB. Nous les utilisons au travers de scripts NodeJS et Python.</span></p><p class="c0"><span></span></p><h1 class="c2"><a name="h.pd2gdfp4b6k6"></a><span>Architecture</span></h1><p class="c2"><span>Voici l&rsquo;architecture du projet :</span></p><p class="c0"><span></span></p><p class="c2 c18"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 470.50px; height: 348.27px;"><img alt="" src="images/image00.png" style="width: 470.50px; height: 348.27px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0"><span></span></p><p class="c2"><span>Les trois lecteurs NFC sons connect&eacute;s en USB sur le port </span><span class="c6">USB Host </span><span>du Galileo. Le Galileo est reli&eacute; directement au PC par un cable RJ 45.</span></p><p class="c0"><span></span></p><hr style="page-break-before:always;display:none;"><p class="c0"><span></span></p><h2 class="c2"><a name="h.fw83gaxgadd9"></a><span>Galileo</span></h2><p class="c2"><span>Le Galileo fait tourner un syst&egrave;me Linux pr&eacute;sent sur sa carte SD. Le fait d&rsquo;avoir Linux sur le </span><span>Galileo nous permet d&rsquo;avoir le support de l&rsquo;USB ainsi qu&rsquo;un interpr&egrave;te python et l&rsquo;ajout des librairies n&eacute;cessaires pour mqtt est &eacute;galement facilit&eacute;. Nous avons compil&eacute; mosquitto (Mqtt) directement sur la carte pour pouvoir lancer un broker Mqtt et se servir des bindings python pour le Mqtt.</span></p><h2 class="c2"><a name="h.1osdm9s5zv2k"></a><span>PC</span></h2><p class="c2"><span>Le PC a lui aussi un broker Mqtt qui tourne et qui lui permet de recevoir les messages envoy&eacute; par le Galileo. On lance &eacute;galement une base de donn&eacute;es MongoDB qui nous sert &agrave; stocker les votes. Pour finir nous utilisons un serveur NodeJS pour recevoir les messages du Galileo et remplir la base de donn&eacute;es.</span></p><p class="c0"><span></span></p><h1 class="c2"><a name="h.i0rfymv6vvl4"></a><span>Logiciel</span></h1><h2 class="c2"><a name="h.155ox57qjy2b"></a><span>Galileo</span></h2><p class="c2"><span>On lance trois scripts python, un pour chaque lecteur NFC branch&eacute; en USB. Chacun g&egrave;re une valeur pour le vote (Positif=0, N&eacute;gatif=1, Neutre=2). Pour lancer ces scripts il faut r&eacute;cup&eacute;rer l&rsquo;identifiant du device USB &agrave; l&rsquo;aide de la commande lsusb :</span></p><p class="c0"><span></span></p><a href="#" name="ecfa5ede0d0f01a851eea03ae6dcc29fdd6bcb6d"></a><a href="#" name="3"></a><table cellpadding="0" cellspacing="0" class="c11"><tbody><tr class="c5"><td class="c14"><p class="c2 c3"><span class="c9 c1 c16">root@clanton:~# lsusb</span></p><p class="c3 c2"><span class="c1">Bus </span><span class="c1">002</span><span class="c1">&nbsp;Device </span><span class="c1">003</span><span class="c9 c1 c16">: ID 05e3:0608 Genesys Logic, Inc. USB-2.0 4-Port HUB</span></p><p class="c3 c2"><span class="c9 c1 c16">Bus 001 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub</span></p><p class="c3 c2"><span class="c9 c1 c16">Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span></p><p class="c3 c2"><span class="c1">Bus </span><span class="c1 c4">002</span><span class="c1">&nbsp;Device </span><span class="c1 c4">005</span><span class="c1">: ID 04e6:5591</span><span class="c1 c4 c9">&nbsp;SCM Microsystems, Inc.</span></p><p class="c3 c2"><span class="c9 c1 c16">Bus 002 Device 004: ID 04e6:5591 SCM Microsystems, Inc.</span></p></td></tr></tbody></table><p class="c0"><span></span></p><p class="c2"><span>Par exemple si l&rsquo;on s&rsquo;int&eacute;resse au premier lecteur SCM Microsystems, les identifiants qui nous int&eacute;ressent sont 002 et 005.</span></p><p class="c2"><span>Admettons qu&rsquo;on affecte &agrave; ce lecteur la valeur 0, voici l&rsquo;appel &agrave; effectuer :</span></p><p class="c0"><span></span></p><a href="#" name="6e5d20302cfb2e6bcd6cf63a9574416d0c10282b"></a><a href="#" name="4"></a><table cellpadding="0" cellspacing="0" class="c11"><tbody><tr class="c5"><td class="c14"><p class="c3 c2"><span class="c1">python read.py 002:005 1</span></p></td></tr></tbody></table><p class="c0"><span></span></p><p class="c2"><span>On fera de m&ecirc;me pour les autres lecteurs.</span></p><p class="c2"><span>Le script read.py se sert de la librairie python nfc. On d&eacute;finit un handler pour chaque lecture d&rsquo;un tag NFC. Ce handler lit le contenu du tag NFC et transmet dans un message Mqtt l&rsquo;id du votant et la valeur du vote.</span></p><hr style="page-break-before:always;display:none;"><p class="c0"><span></span></p><h2 class="c2"><a name="h.j8ot1tihnb6"></a><span>PC</span></h2><p class="c2"><span>Du c&ocirc;t&eacute; du PC on a dans un premier temps un serveur NodeJS qui permet d&rsquo;interfacer avec le Galileo, la base de donn&eacute;es MongoDB et le programme python d&rsquo;affichage des votes.</span></p><p class="c2"><span>La base de donn&eacute;es MongoDB permet le stockage des votes. Elle nous permet &eacute;galement indirectement de v&eacute;rifier qu&rsquo;une personne ne v&ocirc;te pas deux fois gr&acirc;ce &agrave; l&rsquo;exception duplicate key qui est lev&eacute; si la personne a d&eacute;j&agrave; v&ocirc;t&eacute;.</span></p><p class="c0"><span></span></p><p class="c2"><span>Pour le serveur NodeJS on a besoin de deux parties principales.</span></p><p class="c2"><span>La premi&egrave;re partie est la base de donn&eacute;es mongoDB. On se connecte &agrave; celle-ci pour pouvoir ajouter des entr&eacute;es. Pour ajouter des entr&eacute;es il faut cr&eacute;er un sch&eacute;ma, il est compos&eacute; d&#39;un id unique et de la valeur du vote.</span></p><p class="c2"><span>La seconde partie est le support des messages mqtt. A chaque vote, on re&ccedil;oit un message mqtt qui nous en informe. Pour cela on souscrit au topic des votes, avec un client qui &eacute;coute sur l&#39;ip du galileo.</span></p><p class="c2"><span>A chaque r&eacute;ception d&#39;un message on tente d&#39;ins&eacute;rer le vote avec l&#39;id du votant. Si cet id est d&eacute;j&agrave; pr&eacute;sent dans la table on ne duplique pas son vote et on affiche un message d&#39;erreur. Si le vote est valide on transmet un second message mqtt sur un autre topic qui servira &agrave; l&#39;affichage.</span></p><p class="c0"><span class="c6"></span></p><p class="c2"><span>Le programme d&rsquo;affichage lorsqu&rsquo;il est lanc&eacute; r&eacute;cup&egrave;re les valeurs d&eacute;j&agrave; pr&eacute;sente en base de donn&eacute;es. Par la suite &agrave; chaque r&eacute;ception d&rsquo;un message mqtt constitu&eacute; de la valeur du vote l&rsquo;affichage est actualis&eacute;. L&rsquo;affichage est r&eacute;alis&eacute; &agrave; l&rsquo;aide de la librairie pygame qui permet d&rsquo;afficher des rectangles et du texte. Les coordonn&eacute;es des rectangles sont calcul&eacute;s selon la taille du plus grand des trois, de mani&egrave;re &agrave; ce que l&rsquo;&eacute;chelle soit respect&eacute;e.</span></p><p class="c2 c19"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 350.67px;"><img alt="affichage.png" src="images/image01.png" style="width: 624.00px; height: 350.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></body></html>